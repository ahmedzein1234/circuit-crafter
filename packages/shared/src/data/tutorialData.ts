/**
 * Tutorial Campaign Data for Circuit Crafter
 *
 * 6 Chapters with progressive difficulty:
 * 1. Basics - Understanding circuits and current flow
 * 2. Ohm's Law - Voltage, current, and resistance relationships
 * 3. LED Circuits - Current limiting and forward voltage
 * 4. Series & Parallel - Resistor combinations
 * 5. Logic Gates - Digital logic fundamentals
 * 6. Advanced - Transistors, capacitors, and complex circuits
 */

import type {
  TutorialChapter,
  TutorialLevel,
  TutorialChapterId,
} from '../types/tutorial';
import type { BatteryComponent } from '../types/components';

// ==================== Chapter 1: Circuit Basics ====================

const basicsLevels: TutorialLevel[] = [
  {
    id: 'basics_1',
    chapterId: 'basics',
    order: 1,
    title: 'Your First Circuit',
    description: 'Learn what makes a complete circuit by connecting a battery to an LED.',
    educationalConcept: {
      title: 'What is a Circuit?',
      explanation: 'A circuit is a closed loop that allows electricity to flow from a power source (like a battery), through components, and back to the source. For current to flow, the circuit must be complete - any break stops the flow!',
      keyTerms: [
        { term: 'Circuit', definition: 'A closed path through which electric current can flow' },
        { term: 'Current', definition: 'The flow of electrons through a conductor, measured in Amperes (A)' },
        { term: 'Complete Circuit', definition: 'A circuit with no breaks, allowing current to flow continuously' },
      ],
      relatedComponents: ['battery', 'led', 'resistor'],
    },
    objectives: [
      {
        id: 'basics_1_add_battery',
        description: 'Add a battery to the canvas',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'battery' },
        required: true,
        order: 1,
      },
      {
        id: 'basics_1_add_resistor',
        description: 'Add a resistor to protect the LED',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor' },
        required: true,
        order: 2,
      },
      {
        id: 'basics_1_add_led',
        description: 'Add an LED to the circuit',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'led' },
        required: true,
        order: 3,
      },
      {
        id: 'basics_1_connect',
        description: 'Connect all components to complete the circuit',
        type: 'wire_count',
        config: { type: 'wire_count', min: 3 },
        required: true,
        order: 4,
      },
      {
        id: 'basics_1_simulate',
        description: 'Run the simulation to light up the LED!',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.3 },
        required: true,
        order: 5,
      },
    ],
    hints: [
      {
        id: 'basics_1_hint_1',
        order: 1,
        content: 'Start by dragging a Battery from the "Power" section in the component palette onto the canvas.',
        triggerCondition: { type: 'user_request' },
        targetElement: '.component-palette',
      },
      {
        id: 'basics_1_hint_2',
        order: 2,
        content: 'LEDs need a resistor to limit current, or they will burn out! Add a resistor from the "Passive" section.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'basics_1_hint_3',
        order: 3,
        content: 'Click on a terminal (small dot) to start a wire, then click another terminal to connect them. Connect: Battery(+) → Resistor → LED(+) → LED(-) → Battery(-)',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 50,
    bonusXp: 25,
    timeBonusThresholdSeconds: 120,
    unlocksLevelIds: ['basics_2'],
  },
  {
    id: 'basics_2',
    chapterId: 'basics',
    order: 2,
    title: 'The Switch',
    description: 'Add control to your circuit with a switch that turns the LED on and off.',
    educationalConcept: {
      title: 'Controlling Current Flow',
      explanation: 'A switch is like a gate for electricity. When closed (ON), current flows through. When open (OFF), it breaks the circuit and stops current flow. This is how light switches in your home work!',
      keyTerms: [
        { term: 'Switch', definition: 'A device that opens or closes a circuit, controlling current flow' },
        { term: 'Open Circuit', definition: 'A circuit with a break - no current can flow' },
        { term: 'Closed Circuit', definition: 'A complete circuit - current flows freely' },
      ],
      relatedComponents: ['switch', 'battery', 'led'],
    },
    prerequisiteLevelId: 'basics_1',
    objectives: [
      {
        id: 'basics_2_add_switch',
        description: 'Add a switch to control the circuit',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'switch' },
        required: true,
        order: 1,
      },
      {
        id: 'basics_2_build_circuit',
        description: 'Build a circuit with battery, switch, resistor, and LED',
        type: 'component_count',
        config: { type: 'component_count', min: 4 },
        required: true,
        order: 2,
      },
      {
        id: 'basics_2_led_works',
        description: 'Make the LED light up when the switch is closed',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.3 },
        required: true,
        order: 3,
      },
    ],
    hints: [
      {
        id: 'basics_2_hint_1',
        order: 1,
        content: 'Find the Switch in the "Passive" section of the component palette.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'basics_2_hint_2',
        order: 2,
        content: 'Place the switch in series with your other components. Current must pass through the switch to reach the LED.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'basics_2_hint_3',
        order: 3,
        content: 'Click on the switch component to toggle it open/closed. The switch starts in the OPEN position.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 60,
    bonusXp: 30,
    timeBonusThresholdSeconds: 150,
    unlocksLevelIds: ['basics_3'],
  },
  {
    id: 'basics_3',
    chapterId: 'basics',
    order: 3,
    title: 'Ground Reference',
    description: 'Learn about ground - the reference point for all circuit voltages.',
    educationalConcept: {
      title: 'What is Ground?',
      explanation: 'Ground is the reference point (0V) for measuring all voltages in a circuit. It provides a common return path for current. In real circuits, ground often connects to the Earth or a metal chassis.',
      keyTerms: [
        { term: 'Ground', definition: 'The 0V reference point in a circuit' },
        { term: 'Voltage Reference', definition: 'A fixed point against which all other voltages are measured' },
        { term: 'Return Path', definition: 'The route current takes to get back to the power source' },
      ],
      relatedComponents: ['ground', 'battery'],
    },
    prerequisiteLevelId: 'basics_2',
    objectives: [
      {
        id: 'basics_3_add_ground',
        description: 'Add a ground symbol to your circuit',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'ground' },
        required: true,
        order: 1,
      },
      {
        id: 'basics_3_connect_ground',
        description: 'Connect ground to the battery negative terminal',
        type: 'connect_terminals',
        config: { type: 'connect_terminals', fromComponentType: 'ground', toComponentType: 'battery' },
        required: true,
        order: 2,
      },
      {
        id: 'basics_3_complete',
        description: 'Complete the circuit and light the LED',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.3 },
        required: true,
        order: 3,
      },
    ],
    hints: [
      {
        id: 'basics_3_hint_1',
        order: 1,
        content: 'The ground symbol is in the "Power" section. It represents 0V.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'basics_3_hint_2',
        order: 2,
        content: 'Connect the ground to the negative (-) terminal of the battery. This establishes the 0V reference.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 50,
    bonusXp: 25,
    timeBonusThresholdSeconds: 120,
    unlocksLevelIds: ['basics_4'],
  },
  {
    id: 'basics_4',
    chapterId: 'basics',
    order: 4,
    title: 'Two LEDs',
    description: 'Power multiple LEDs in your circuit.',
    educationalConcept: {
      title: 'Powering Multiple Components',
      explanation: 'A single power source can power multiple components! When components share the same power source, you need to plan your connections carefully. Each LED needs its own current-limiting resistor.',
      keyTerms: [
        { term: 'Current Path', definition: 'The route current takes through a circuit' },
        { term: 'Branch', definition: 'A separate path in a circuit where current can flow' },
        { term: 'Current Limiting', definition: 'Using a resistor to prevent too much current from damaging a component' },
      ],
      relatedComponents: ['led', 'resistor', 'battery'],
    },
    prerequisiteLevelId: 'basics_3',
    objectives: [
      {
        id: 'basics_4_two_leds',
        description: 'Add two LEDs to your circuit',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'led', count: 2 },
        required: true,
        order: 1,
      },
      {
        id: 'basics_4_two_resistors',
        description: 'Add a resistor for each LED',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor', count: 2 },
        required: true,
        order: 2,
      },
      {
        id: 'basics_4_light_both',
        description: 'Make both LEDs light up',
        type: 'power_multiple_leds',
        config: { type: 'power_multiple_leds', count: 2, minBrightness: 0.3 },
        required: true,
        order: 3,
      },
    ],
    hints: [
      {
        id: 'basics_4_hint_1',
        order: 1,
        content: 'Each LED needs its own resistor to limit current. Without resistors, LEDs will burn out!',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'basics_4_hint_2',
        order: 2,
        content: 'Connect both LED-resistor pairs to the same battery. They share the power source but have separate current paths.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 75,
    bonusXp: 40,
    timeBonusThresholdSeconds: 180,
    unlocksLevelIds: ['basics_5'],
  },
  {
    id: 'basics_5',
    chapterId: 'basics',
    order: 5,
    title: 'Circuit Safety',
    description: 'Learn about protecting circuits with fuses.',
    educationalConcept: {
      title: 'Circuit Protection',
      explanation: 'A fuse is a safety device that protects your circuit. If too much current flows (like in a short circuit), the fuse "blows" and breaks the circuit, preventing damage or fire. Every home and car has fuses!',
      keyTerms: [
        { term: 'Fuse', definition: 'A protective device that melts and breaks the circuit if current is too high' },
        { term: 'Overcurrent', definition: 'Current that exceeds the safe level for a circuit' },
        { term: 'Short Circuit', definition: 'An unintended low-resistance path that causes excessive current' },
      ],
      relatedComponents: ['fuse', 'battery', 'resistor'],
    },
    prerequisiteLevelId: 'basics_4',
    objectives: [
      {
        id: 'basics_5_add_fuse',
        description: 'Add a fuse to protect your circuit',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'fuse' },
        required: true,
        order: 1,
      },
      {
        id: 'basics_5_build_protected',
        description: 'Build a protected circuit with fuse, resistor, and LED',
        type: 'component_count',
        config: { type: 'component_count', min: 4 },
        required: true,
        order: 2,
      },
      {
        id: 'basics_5_working',
        description: 'Make the circuit work with the fuse intact',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.3 },
        required: true,
        order: 3,
      },
    ],
    hints: [
      {
        id: 'basics_5_hint_1',
        order: 1,
        content: 'Find the Fuse in the "Protection" section of the component palette.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'basics_5_hint_2',
        order: 2,
        content: 'Place the fuse in series with your circuit, typically right after the battery positive terminal.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'basics_5_hint_3',
        order: 3,
        content: 'The fuse should NOT blow in a properly designed circuit. If it blows, your resistance is too low!',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 80,
    bonusXp: 40,
    timeBonusThresholdSeconds: 180,
    unlocksLevelIds: ['ohms_law_1'],
  },
];

// ==================== Chapter 2: Ohm's Law ====================

const ohmsLawLevels: TutorialLevel[] = [
  {
    id: 'ohms_law_1',
    chapterId: 'ohms_law',
    order: 1,
    title: 'The Magic Formula',
    description: 'Discover Ohm\'s Law - the most important formula in electronics!',
    educationalConcept: {
      title: 'Ohm\'s Law: V = I x R',
      explanation: 'Ohm\'s Law describes the relationship between Voltage (V), Current (I), and Resistance (R). If you know any two, you can calculate the third! V = I x R, I = V/R, R = V/I. This is the foundation of all circuit analysis.',
      formula: 'V = I × R',
      formulaDescription: 'Voltage (Volts) = Current (Amps) × Resistance (Ohms)',
      keyTerms: [
        { term: 'Voltage (V)', definition: 'Electrical pressure that pushes current through a circuit, measured in Volts' },
        { term: 'Current (I)', definition: 'The flow rate of electrons, measured in Amperes (Amps)' },
        { term: 'Resistance (R)', definition: 'Opposition to current flow, measured in Ohms (Ω)' },
      ],
      relatedComponents: ['battery', 'resistor'],
    },
    starterCircuit: {
      components: [
        {
          id: 'starter_battery_ohm1',
          type: 'battery',
          position: { x: 100, y: 200 },
          rotation: 0,
          terminals: [
            { id: 'bat_pos', type: 'positive', position: { x: 130, y: 200 }, connectedTo: [] },
            { id: 'bat_neg', type: 'negative', position: { x: 70, y: 200 }, connectedTo: [] },
          ],
          properties: { voltage: 9 },
        } as BatteryComponent,
      ],
      wires: [],
      lockedComponentIds: ['starter_battery_ohm1'],
      highlightedTerminalIds: ['bat_pos', 'bat_neg'],
    },
    objectives: [
      {
        id: 'ohms_law_1_add_resistor',
        description: 'Add a 1000Ω resistor to the circuit',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor' },
        required: true,
        order: 1,
      },
      {
        id: 'ohms_law_1_connect',
        description: 'Connect the resistor to complete the circuit',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 2,
      },
      {
        id: 'ohms_law_1_calculate',
        description: 'Calculate: With 9V and 1000Ω, current = 9mA (V/R)',
        type: 'achieve_current',
        config: { type: 'achieve_current', componentType: 'resistor', targetCurrent: 0.009, tolerance: 0.002 },
        required: true,
        order: 3,
      },
    ],
    hints: [
      {
        id: 'ohms_law_1_hint_1',
        order: 1,
        content: 'The battery is already placed (9V). Add a 1000Ω resistor to see Ohm\'s Law in action!',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'ohms_law_1_hint_2',
        order: 2,
        content: 'Using Ohm\'s Law: I = V/R = 9V / 1000Ω = 0.009A = 9mA',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'ohms_law_1_hint_3',
        order: 3,
        content: 'Open the Formula Calculator (click on the resistor, then Calculator tab) to verify your calculation!',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'voltage_match', tolerancePercent: 10 },
    xpReward: 75,
    bonusXp: 35,
    timeBonusThresholdSeconds: 120,
    unlocksLevelIds: ['ohms_law_2'],
  },
  {
    id: 'ohms_law_2',
    chapterId: 'ohms_law',
    order: 2,
    title: 'Changing Resistance',
    description: 'See how changing resistance affects current flow.',
    educationalConcept: {
      title: 'Resistance and Current',
      explanation: 'According to Ohm\'s Law (I = V/R), when voltage stays constant, increasing resistance DECREASES current. Double the resistance = half the current. This is why we use resistors to control LED brightness!',
      formula: 'I = V / R',
      formulaDescription: 'Current is inversely proportional to resistance',
      keyTerms: [
        { term: 'Inverse Relationship', definition: 'When one value increases, the other decreases' },
        { term: 'Current Limiting', definition: 'Using resistance to reduce current to a safe level' },
      ],
      relatedComponents: ['resistor', 'led', 'battery'],
    },
    prerequisiteLevelId: 'ohms_law_1',
    objectives: [
      {
        id: 'ohms_law_2_circuit',
        description: 'Build a circuit with a battery, resistor, and LED',
        type: 'component_count',
        config: { type: 'component_count', min: 3 },
        required: true,
        order: 1,
      },
      {
        id: 'ohms_law_2_bright_led',
        description: 'Make the LED glow brightly (lower resistance = more current)',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.7 },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'ohms_law_2_hint_1',
        order: 1,
        content: 'To get more current through the LED, you need LESS resistance. Try a smaller resistor value.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'ohms_law_2_hint_2',
        order: 2,
        content: 'Select the resistor and change its resistance value in the properties panel. Try 220Ω or 330Ω.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'ohms_law_2_hint_3',
        order: 3,
        content: 'Warning: Too little resistance can damage the LED! Keep current under 20mA (0.02A).',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 80,
    bonusXp: 40,
    timeBonusThresholdSeconds: 150,
    unlocksLevelIds: ['ohms_law_3'],
  },
  {
    id: 'ohms_law_3',
    chapterId: 'ohms_law',
    order: 3,
    title: 'Voltage Division',
    description: 'Learn how voltage divides across components in a circuit.',
    educationalConcept: {
      title: 'Voltage Drops',
      explanation: 'In a series circuit, the total voltage from the battery is divided among all components. The voltage drop across each component depends on its resistance. Higher resistance = larger voltage drop.',
      formula: 'V_total = V1 + V2 + V3...',
      formulaDescription: 'The sum of all voltage drops equals the source voltage',
      keyTerms: [
        { term: 'Voltage Drop', definition: 'The decrease in voltage across a component as current flows through it' },
        { term: 'Series Circuit', definition: 'A circuit where components are connected end-to-end, sharing the same current' },
        { term: 'Kirchhoff\'s Voltage Law', definition: 'The sum of voltages around a closed loop equals zero' },
      ],
      relatedComponents: ['battery', 'resistor', 'led'],
    },
    prerequisiteLevelId: 'ohms_law_2',
    objectives: [
      {
        id: 'ohms_law_3_two_resistors',
        description: 'Add two resistors in series',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor', count: 2 },
        required: true,
        order: 1,
      },
      {
        id: 'ohms_law_3_complete',
        description: 'Complete the circuit and observe how voltage divides',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'ohms_law_3_hint_1',
        order: 1,
        content: 'Connect two resistors in series (end to end). Current flows through both sequentially.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'ohms_law_3_hint_2',
        order: 2,
        content: 'Use the Simulation Panel to see the voltage drop across each resistor after running the simulation.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'ohms_law_3_hint_3',
        order: 3,
        content: 'Try different resistor values! A bigger resistor will have a bigger voltage drop.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'voltage_match', tolerancePercent: 10 },
    xpReward: 85,
    bonusXp: 45,
    timeBonusThresholdSeconds: 180,
    unlocksLevelIds: ['ohms_law_4'],
  },
  {
    id: 'ohms_law_4',
    chapterId: 'ohms_law',
    order: 4,
    title: 'Power Calculation',
    description: 'Calculate power consumption using P = V x I.',
    educationalConcept: {
      title: 'Electrical Power',
      explanation: 'Power (P) is the rate at which electrical energy is converted to another form (heat, light, motion). P = V × I = I²R = V²/R. Power is measured in Watts (W). This is what you pay for on your electric bill!',
      formula: 'P = V × I',
      formulaDescription: 'Power (Watts) = Voltage (Volts) × Current (Amps)',
      keyTerms: [
        { term: 'Power (P)', definition: 'Rate of energy transfer, measured in Watts (W)' },
        { term: 'Watt', definition: 'One Joule of energy per second' },
        { term: 'Power Dissipation', definition: 'Energy released as heat when current flows through resistance' },
      ],
      relatedComponents: ['resistor', 'battery', 'led'],
    },
    prerequisiteLevelId: 'ohms_law_3',
    objectives: [
      {
        id: 'ohms_law_4_circuit',
        description: 'Build a circuit with a battery and resistor',
        type: 'component_count',
        config: { type: 'component_count', min: 2 },
        required: true,
        order: 1,
      },
      {
        id: 'ohms_law_4_simulate',
        description: 'Run simulation and check the power reading',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'ohms_law_4_hint_1',
        order: 1,
        content: 'Build a simple circuit: 9V battery with a 100Ω resistor.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'ohms_law_4_hint_2',
        order: 2,
        content: 'Calculate: I = 9V/100Ω = 0.09A, then P = 9V × 0.09A = 0.81W',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'ohms_law_4_hint_3',
        order: 3,
        content: 'Use the Power Calculator in the Formula Calculator panel to verify your calculation!',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 90,
    bonusXp: 45,
    timeBonusThresholdSeconds: 150,
    unlocksLevelIds: ['ohms_law_5'],
  },
  {
    id: 'ohms_law_5',
    chapterId: 'ohms_law',
    order: 5,
    title: 'Ohm\'s Law Challenge',
    description: 'Put it all together! Design a circuit to achieve a specific current.',
    educationalConcept: {
      title: 'Applying Ohm\'s Law',
      explanation: 'Now you can use Ohm\'s Law to DESIGN circuits! Given a target current and voltage, calculate the resistance needed: R = V/I. This is how engineers design everything from phone chargers to power supplies.',
      formula: 'R = V / I',
      formulaDescription: 'Calculate the resistance needed for a target current',
      keyTerms: [
        { term: 'Design', definition: 'Calculating component values to achieve desired circuit behavior' },
        { term: 'Target Current', definition: 'The specific current value you want to achieve' },
        { term: 'Component Selection', definition: 'Choosing the right resistor value for your needs' },
      ],
      relatedComponents: ['resistor', 'battery', 'led'],
    },
    prerequisiteLevelId: 'ohms_law_4',
    objectives: [
      {
        id: 'ohms_law_5_target_current',
        description: 'Design a circuit that produces exactly 15mA (0.015A) with a 9V battery',
        type: 'achieve_current',
        config: { type: 'achieve_current', componentType: 'resistor', targetCurrent: 0.015, tolerance: 0.002 },
        required: true,
        order: 1,
      },
      {
        id: 'ohms_law_5_no_warnings',
        description: 'Complete without any circuit warnings',
        type: 'no_warnings',
        config: { type: 'no_warnings' },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'ohms_law_5_hint_1',
        order: 1,
        content: 'Target: 15mA (0.015A) with 9V. Use R = V/I to find the resistor value needed.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'ohms_law_5_hint_2',
        order: 2,
        content: 'R = 9V / 0.015A = 600Ω. Use a 600Ω resistor (or the closest value).',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'ohms_law_5_hint_3',
        order: 3,
        content: 'Select the resistor and adjust its value to 600Ω in the properties panel.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 100,
    bonusXp: 50,
    timeBonusThresholdSeconds: 180,
    unlocksLevelIds: ['led_circuits_1'],
  },
];

// ==================== Chapter 3: LED Circuits ====================

const ledCircuitsLevels: TutorialLevel[] = [
  {
    id: 'led_circuits_1',
    chapterId: 'led_circuits',
    order: 1,
    title: 'LED Basics',
    description: 'Learn why LEDs need resistors and how to calculate the right value.',
    educationalConcept: {
      title: 'LED Forward Voltage',
      explanation: 'LEDs are special - they have a "forward voltage" (Vf) that must be exceeded for them to turn on. A red LED typically has Vf ≈ 2V. The remaining voltage must be dropped across a resistor to limit current.',
      formula: 'R = (V_source - V_forward) / I_led',
      formulaDescription: 'Calculate the resistor needed to safely power an LED',
      keyTerms: [
        { term: 'Forward Voltage (Vf)', definition: 'The minimum voltage needed across an LED to make it light up' },
        { term: 'LED Current', definition: 'Typical LEDs work best at 10-20mA' },
        { term: 'Current Limiting Resistor', definition: 'A resistor that limits current to protect the LED' },
      ],
      relatedComponents: ['led', 'resistor', 'battery'],
    },
    objectives: [
      {
        id: 'led_circuits_1_build',
        description: 'Build a circuit with battery, resistor, and LED',
        type: 'component_count',
        config: { type: 'component_count', min: 3 },
        required: true,
        order: 1,
      },
      {
        id: 'led_circuits_1_safe_current',
        description: 'Make the LED light up without exceeding 20mA',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.5 },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'led_circuits_1_hint_1',
        order: 1,
        content: 'For a 9V battery and red LED (Vf=2V), you need: R = (9-2)/0.02 = 350Ω for 20mA',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'led_circuits_1_hint_2',
        order: 2,
        content: 'A 330Ω or 470Ω resistor is commonly used. Too much resistance = dim LED, too little = damaged LED.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 75,
    bonusXp: 35,
    timeBonusThresholdSeconds: 120,
    unlocksLevelIds: ['led_circuits_2'],
  },
  {
    id: 'led_circuits_2',
    chapterId: 'led_circuits',
    order: 2,
    title: 'LED Brightness Control',
    description: 'Control LED brightness by adjusting current flow.',
    educationalConcept: {
      title: 'Brightness and Current',
      explanation: 'LED brightness is proportional to current. More current = brighter LED (up to its limit). By changing the resistor value, you can dim or brighten the LED. This is called analog brightness control.',
      formula: 'Brightness ∝ Current',
      formulaDescription: 'LED brightness is directly proportional to current',
      keyTerms: [
        { term: 'Proportional', definition: 'When one value increases, the other increases at the same rate' },
        { term: 'Analog Control', definition: 'Continuous adjustment (vs. digital on/off)' },
        { term: 'Current Adjustment', definition: 'Changing resistor value to control current and brightness' },
      ],
      relatedComponents: ['led', 'resistor'],
    },
    prerequisiteLevelId: 'led_circuits_1',
    objectives: [
      {
        id: 'led_circuits_2_dim',
        description: 'Create a dim LED (use high resistance)',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.2 },
        required: true,
        order: 1,
      },
      {
        id: 'led_circuits_2_bright',
        description: 'Then make it bright (lower resistance)',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.8 },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'led_circuits_2_hint_1',
        order: 1,
        content: 'For a dim LED, use a high resistance like 2200Ω or more. This limits current to just a few mA.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'led_circuits_2_hint_2',
        order: 2,
        content: 'For bright LED, use around 220Ω-330Ω. This gives about 20mA - the LED\'s optimal current.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 80,
    bonusXp: 40,
    timeBonusThresholdSeconds: 150,
    unlocksLevelIds: ['led_circuits_3'],
  },
  {
    id: 'led_circuits_3',
    chapterId: 'led_circuits',
    order: 3,
    title: 'Multiple LEDs in Series',
    description: 'Connect LEDs in series for higher voltage applications.',
    educationalConcept: {
      title: 'LEDs in Series',
      explanation: 'When LEDs are connected in series, their forward voltages ADD UP. 3 red LEDs in series need 6V to light up! You need a power source voltage greater than the sum of all Vf values.',
      formula: 'V_total = Vf1 + Vf2 + Vf3...',
      formulaDescription: 'Total voltage drop = sum of individual LED forward voltages',
      keyTerms: [
        { term: 'Series Connection', definition: 'Components connected end-to-end, same current flows through all' },
        { term: 'Voltage Addition', definition: 'In series, voltages add up' },
        { term: 'Shared Current', definition: 'All components in series have the same current' },
      ],
      relatedComponents: ['led', 'resistor', 'battery'],
    },
    prerequisiteLevelId: 'led_circuits_2',
    objectives: [
      {
        id: 'led_circuits_3_two_series',
        description: 'Connect 2 LEDs in series',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'led', count: 2 },
        required: true,
        order: 1,
      },
      {
        id: 'led_circuits_3_light_both',
        description: 'Make both LEDs light up equally',
        type: 'power_multiple_leds',
        config: { type: 'power_multiple_leds', count: 2, minBrightness: 0.4 },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'led_circuits_3_hint_1',
        order: 1,
        content: 'Connect LED1 positive to LED2 negative. They share the same current path.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'led_circuits_3_hint_2',
        order: 2,
        content: 'For 2 LEDs (4V total Vf) with 9V: R = (9-4)/0.015 = 333Ω',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 90,
    bonusXp: 45,
    timeBonusThresholdSeconds: 180,
    unlocksLevelIds: ['led_circuits_4'],
  },
  {
    id: 'led_circuits_4',
    chapterId: 'led_circuits',
    order: 4,
    title: 'Multiple LEDs in Parallel',
    description: 'Power multiple LEDs with separate resistors.',
    educationalConcept: {
      title: 'LEDs in Parallel',
      explanation: 'Each LED in a parallel configuration needs its own current-limiting resistor! Never connect LEDs directly in parallel - slight differences in Vf cause uneven current distribution and damage.',
      formula: 'I_total = I1 + I2 + I3...',
      formulaDescription: 'Total current = sum of current through each LED',
      keyTerms: [
        { term: 'Parallel Connection', definition: 'Components connected between the same two points' },
        { term: 'Current Division', definition: 'Total current splits among parallel branches' },
        { term: 'Individual Resistors', definition: 'Each parallel LED needs its own current limiter' },
      ],
      relatedComponents: ['led', 'resistor', 'battery'],
    },
    prerequisiteLevelId: 'led_circuits_3',
    objectives: [
      {
        id: 'led_circuits_4_parallel_leds',
        description: 'Add 3 LEDs in parallel branches',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'led', count: 3 },
        required: true,
        order: 1,
      },
      {
        id: 'led_circuits_4_resistors',
        description: 'Add a resistor for each LED',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor', count: 3 },
        required: true,
        order: 2,
      },
      {
        id: 'led_circuits_4_all_lit',
        description: 'Light all 3 LEDs',
        type: 'power_multiple_leds',
        config: { type: 'power_multiple_leds', count: 3, minBrightness: 0.4 },
        required: true,
        order: 3,
      },
    ],
    hints: [
      {
        id: 'led_circuits_4_hint_1',
        order: 1,
        content: 'Create 3 separate branches from the battery. Each branch: resistor → LED.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'led_circuits_4_hint_2',
        order: 2,
        content: 'All branches connect to the same battery terminals, but have separate current paths.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 95,
    bonusXp: 50,
    timeBonusThresholdSeconds: 200,
    unlocksLevelIds: ['led_circuits_5'],
  },
  {
    id: 'led_circuits_5',
    chapterId: 'led_circuits',
    order: 5,
    title: 'LED Challenge',
    description: 'Design a circuit with both series and parallel LEDs!',
    educationalConcept: {
      title: 'Combined Configurations',
      explanation: 'Real circuits often combine series and parallel. You might have 2 series pairs, each pair in parallel with the other. This balances voltage requirements with current distribution.',
      keyTerms: [
        { term: 'Series-Parallel', definition: 'A combination of series and parallel connections' },
        { term: 'Branch', definition: 'A separate current path in a parallel circuit' },
        { term: 'Balanced Design', definition: 'Ensuring all LEDs receive appropriate current' },
      ],
      relatedComponents: ['led', 'resistor', 'battery'],
    },
    prerequisiteLevelId: 'led_circuits_4',
    objectives: [
      {
        id: 'led_circuits_5_four_leds',
        description: 'Create a circuit with 4 LEDs',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'led', count: 4 },
        required: true,
        order: 1,
      },
      {
        id: 'led_circuits_5_all_lit',
        description: 'Light all 4 LEDs',
        type: 'power_multiple_leds',
        config: { type: 'power_multiple_leds', count: 4, minBrightness: 0.4 },
        required: true,
        order: 2,
      },
      {
        id: 'led_circuits_5_efficient',
        description: 'Use minimum components (hint: series-parallel)',
        type: 'no_warnings',
        config: { type: 'no_warnings' },
        required: true,
        order: 3,
      },
    ],
    hints: [
      {
        id: 'led_circuits_5_hint_1',
        order: 1,
        content: 'Try 2 pairs of series LEDs, with each pair in parallel. This uses only 2 resistors!',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'led_circuits_5_hint_2',
        order: 2,
        content: 'Branch 1: Resistor → LED1 → LED2. Branch 2: Resistor → LED3 → LED4. Both share battery.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 110,
    bonusXp: 55,
    timeBonusThresholdSeconds: 240,
    unlocksLevelIds: ['series_parallel_1'],
  },
];

// ==================== Chapter 4: Series & Parallel ====================

const seriesParallelLevels: TutorialLevel[] = [
  {
    id: 'series_parallel_1',
    chapterId: 'series_parallel',
    order: 1,
    title: 'Resistors in Series',
    description: 'Learn how resistances add up in series.',
    educationalConcept: {
      title: 'Series Resistance',
      explanation: 'When resistors are in series, their resistances simply ADD together. R_total = R1 + R2 + R3. The same current flows through all of them, but voltage divides among them.',
      formula: 'R_total = R1 + R2 + R3...',
      formulaDescription: 'Total resistance = sum of individual resistances',
      keyTerms: [
        { term: 'Series Addition', definition: 'Resistances in series add directly' },
        { term: 'Same Current', definition: 'All series components share the same current' },
        { term: 'Voltage Division', definition: 'Voltage splits according to resistance ratio' },
      ],
      relatedComponents: ['resistor', 'battery'],
    },
    objectives: [
      {
        id: 'series_parallel_1_three_resistors',
        description: 'Connect 3 resistors in series',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor', count: 3 },
        required: true,
        order: 1,
      },
      {
        id: 'series_parallel_1_simulate',
        description: 'Verify total resistance in simulation',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'series_parallel_1_hint_1',
        order: 1,
        content: 'Connect resistors end-to-end: Battery(+) → R1 → R2 → R3 → Battery(-)',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'series_parallel_1_hint_2',
        order: 2,
        content: '3 x 1000Ω in series = 3000Ω total. Current = 9V/3000Ω = 3mA',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 75,
    bonusXp: 35,
    timeBonusThresholdSeconds: 120,
    unlocksLevelIds: ['series_parallel_2'],
  },
  {
    id: 'series_parallel_2',
    chapterId: 'series_parallel',
    order: 2,
    title: 'Resistors in Parallel',
    description: 'Discover how parallel resistors combine differently.',
    educationalConcept: {
      title: 'Parallel Resistance',
      explanation: 'Parallel resistors are trickier! 1/R_total = 1/R1 + 1/R2. For two equal resistors in parallel, the total is HALF of one. More paths = easier for current = less total resistance.',
      formula: '1/R_total = 1/R1 + 1/R2',
      formulaDescription: 'Reciprocals add, then take reciprocal of result',
      keyTerms: [
        { term: 'Parallel Resistance', definition: 'Total is always less than the smallest individual resistor' },
        { term: 'Current Splitting', definition: 'Total current divides among parallel paths' },
        { term: 'Same Voltage', definition: 'All parallel components have the same voltage across them' },
      ],
      relatedComponents: ['resistor', 'battery'],
    },
    prerequisiteLevelId: 'series_parallel_1',
    objectives: [
      {
        id: 'series_parallel_2_parallel_resistors',
        description: 'Connect 2 resistors in parallel',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor', count: 2 },
        required: true,
        order: 1,
      },
      {
        id: 'series_parallel_2_observe',
        description: 'Run simulation and observe current through each',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'series_parallel_2_hint_1',
        order: 1,
        content: 'Connect both resistors between the same two points - they share both battery terminals.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'series_parallel_2_hint_2',
        order: 2,
        content: '2 x 1000Ω in parallel = 500Ω. For equal resistors: R_parallel = R/n',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 85,
    bonusXp: 40,
    timeBonusThresholdSeconds: 150,
    unlocksLevelIds: ['series_parallel_3'],
  },
  {
    id: 'series_parallel_3',
    chapterId: 'series_parallel',
    order: 3,
    title: 'Voltage Divider',
    description: 'Build a practical voltage divider circuit.',
    educationalConcept: {
      title: 'Voltage Dividers',
      explanation: 'A voltage divider uses two resistors in series to create a specific output voltage. V_out = V_in × (R2/(R1+R2)). This is used everywhere - from sensor circuits to phone chargers!',
      formula: 'V_out = V_in × (R2 / (R1 + R2))',
      formulaDescription: 'Output voltage based on resistor ratio',
      keyTerms: [
        { term: 'Voltage Divider', definition: 'Two resistors that create a fractional voltage output' },
        { term: 'Output Tap', definition: 'The point between resistors where output is measured' },
        { term: 'Division Ratio', definition: 'The fraction of input voltage that appears at output' },
      ],
      relatedComponents: ['resistor', 'battery'],
    },
    prerequisiteLevelId: 'series_parallel_2',
    objectives: [
      {
        id: 'series_parallel_3_divider',
        description: 'Build a voltage divider with 2 resistors',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor', count: 2 },
        required: true,
        order: 1,
      },
      {
        id: 'series_parallel_3_half_voltage',
        description: 'Create a 50% voltage divider (equal resistors)',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'series_parallel_3_hint_1',
        order: 1,
        content: 'Use two equal resistors. With 9V in, you\'ll get 4.5V at the midpoint.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'series_parallel_3_hint_2',
        order: 2,
        content: 'For different ratios, change R2. More R2 = higher output voltage.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 90,
    bonusXp: 45,
    timeBonusThresholdSeconds: 150,
    unlocksLevelIds: ['series_parallel_4'],
  },
  {
    id: 'series_parallel_4',
    chapterId: 'series_parallel',
    order: 4,
    title: 'Current Divider',
    description: 'Build a current divider and understand current distribution.',
    educationalConcept: {
      title: 'Current Division',
      explanation: 'In parallel circuits, current divides inversely to resistance. The path with LESS resistance gets MORE current. I1/I2 = R2/R1. Current takes the path of least resistance!',
      formula: 'I1 = I_total × (R2 / (R1 + R2))',
      formulaDescription: 'Current in R1 based on opposite resistor ratio',
      keyTerms: [
        { term: 'Current Division', definition: 'Current splits inversely proportional to resistance' },
        { term: 'Path of Least Resistance', definition: 'Current prefers lower resistance paths' },
        { term: 'Branch Current', definition: 'Current flowing through one parallel branch' },
      ],
      relatedComponents: ['resistor', 'battery'],
    },
    prerequisiteLevelId: 'series_parallel_3',
    objectives: [
      {
        id: 'series_parallel_4_unequal',
        description: 'Connect 2 unequal resistors in parallel',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor', count: 2 },
        required: true,
        order: 1,
      },
      {
        id: 'series_parallel_4_observe_current',
        description: 'Observe how current divides between paths',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'series_parallel_4_hint_1',
        order: 1,
        content: 'Use 1000Ω and 2000Ω in parallel. The 1kΩ will carry twice the current!',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'series_parallel_4_hint_2',
        order: 2,
        content: 'Run simulation and compare the current values shown for each resistor.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 95,
    bonusXp: 50,
    timeBonusThresholdSeconds: 180,
    unlocksLevelIds: ['series_parallel_5'],
  },
  {
    id: 'series_parallel_5',
    chapterId: 'series_parallel',
    order: 5,
    title: 'Complex Network',
    description: 'Analyze a series-parallel combination circuit.',
    educationalConcept: {
      title: 'Series-Parallel Analysis',
      explanation: 'Complex circuits combine series and parallel. Solve by simplifying step-by-step: 1) Find parallel groups and combine them 2) Add series resistances 3) Repeat until you have one equivalent resistance.',
      keyTerms: [
        { term: 'Equivalent Resistance', definition: 'A single resistor that has the same effect as the combination' },
        { term: 'Simplification', definition: 'Reducing a complex circuit to simpler form' },
        { term: 'Step-by-Step Analysis', definition: 'Breaking down complex problems into simple steps' },
      ],
      relatedComponents: ['resistor', 'battery'],
    },
    prerequisiteLevelId: 'series_parallel_4',
    objectives: [
      {
        id: 'series_parallel_5_complex',
        description: 'Build a circuit with 4+ resistors in series-parallel',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor', count: 4 },
        required: true,
        order: 1,
      },
      {
        id: 'series_parallel_5_working',
        description: 'Complete the circuit and run simulation',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'series_parallel_5_hint_1',
        order: 1,
        content: 'Try: R1 in series with (R2 || R3) in series with R4. || means parallel.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'series_parallel_5_hint_2',
        order: 2,
        content: 'To calculate: First find R2||R3, then add R1 + (R2||R3) + R4.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 110,
    bonusXp: 55,
    timeBonusThresholdSeconds: 240,
    unlocksLevelIds: ['logic_gates_1'],
  },
];

// ==================== Chapter 5: Logic Gates ====================

const logicGatesLevels: TutorialLevel[] = [
  {
    id: 'logic_gates_1',
    chapterId: 'logic_gates',
    order: 1,
    title: 'Meet the AND Gate',
    description: 'Discover the AND gate - output is HIGH only when ALL inputs are HIGH.',
    educationalConcept: {
      title: 'AND Gate',
      explanation: 'An AND gate outputs HIGH (1) only when ALL inputs are HIGH. If any input is LOW, output is LOW. Think of it as a series of switches - all must be ON for current to flow. A AND B = output.',
      keyTerms: [
        { term: 'AND Gate', definition: 'Output is 1 only if all inputs are 1' },
        { term: 'HIGH/LOW', definition: 'Digital signals: HIGH=1=ON, LOW=0=OFF' },
        { term: 'Truth Table', definition: 'A table showing all input combinations and their outputs' },
      ],
      relatedComponents: ['and_gate', 'switch', 'led'],
    },
    objectives: [
      {
        id: 'logic_gates_1_add_and',
        description: 'Add an AND gate to the circuit',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'and_gate' },
        required: true,
        order: 1,
      },
      {
        id: 'logic_gates_1_inputs',
        description: 'Connect two switches to the AND gate inputs',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'switch', count: 2 },
        required: true,
        order: 2,
      },
      {
        id: 'logic_gates_1_output',
        description: 'Connect the output to an LED',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.3 },
        required: true,
        order: 3,
      },
    ],
    hints: [
      {
        id: 'logic_gates_1_hint_1',
        order: 1,
        content: 'Find the AND gate in the "Logic" section. It has 2 inputs (A, B) and 1 output.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'logic_gates_1_hint_2',
        order: 2,
        content: 'Connect switches to input_a and input_b. The LED lights only when BOTH switches are closed.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 80,
    bonusXp: 40,
    timeBonusThresholdSeconds: 150,
    unlocksLevelIds: ['logic_gates_2'],
  },
  {
    id: 'logic_gates_2',
    chapterId: 'logic_gates',
    order: 2,
    title: 'The OR Gate',
    description: 'Learn the OR gate - output is HIGH when ANY input is HIGH.',
    educationalConcept: {
      title: 'OR Gate',
      explanation: 'An OR gate outputs HIGH if ANY input is HIGH. Only when ALL inputs are LOW does it output LOW. Think of parallel switches - any one can complete the circuit. A OR B = output.',
      keyTerms: [
        { term: 'OR Gate', definition: 'Output is 1 if any input is 1' },
        { term: 'Inclusive OR', definition: 'True if one OR the other OR both are true' },
        { term: 'Parallel Logic', definition: 'Any path can activate the output' },
      ],
      relatedComponents: ['or_gate', 'switch', 'led'],
    },
    prerequisiteLevelId: 'logic_gates_1',
    objectives: [
      {
        id: 'logic_gates_2_add_or',
        description: 'Add an OR gate to the circuit',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'or_gate' },
        required: true,
        order: 1,
      },
      {
        id: 'logic_gates_2_test',
        description: 'Test that either switch lights the LED',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.3 },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'logic_gates_2_hint_1',
        order: 1,
        content: 'The OR gate is also in "Logic". With either input HIGH, the output is HIGH.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'logic_gates_2_hint_2',
        order: 2,
        content: 'Test by closing just switch A, then just switch B - LED should light in both cases.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 80,
    bonusXp: 40,
    timeBonusThresholdSeconds: 150,
    unlocksLevelIds: ['logic_gates_3'],
  },
  {
    id: 'logic_gates_3',
    chapterId: 'logic_gates',
    order: 3,
    title: 'The NOT Gate (Inverter)',
    description: 'Meet the NOT gate - it flips the input signal.',
    educationalConcept: {
      title: 'NOT Gate (Inverter)',
      explanation: 'A NOT gate inverts its input: HIGH becomes LOW, LOW becomes HIGH. It has only one input. NOT gates are fundamental - combined with AND or OR, you can create any logic function!',
      keyTerms: [
        { term: 'NOT Gate', definition: 'Output is the opposite of the input' },
        { term: 'Inverter', definition: 'Another name for NOT gate' },
        { term: 'Complement', definition: 'The inverted value (opposite)' },
      ],
      relatedComponents: ['not_gate', 'switch', 'led'],
    },
    prerequisiteLevelId: 'logic_gates_2',
    objectives: [
      {
        id: 'logic_gates_3_add_not',
        description: 'Add a NOT gate',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'not_gate' },
        required: true,
        order: 1,
      },
      {
        id: 'logic_gates_3_test_invert',
        description: 'Make LED turn OFF when switch is ON',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.3 },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'logic_gates_3_hint_1',
        order: 1,
        content: 'NOT gate has 1 input and 1 output. Connect switch → NOT → LED.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'logic_gates_3_hint_2',
        order: 2,
        content: 'With switch OPEN (LOW input), output is HIGH and LED lights. Close switch = LED off.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 75,
    bonusXp: 35,
    timeBonusThresholdSeconds: 120,
    unlocksLevelIds: ['logic_gates_4'],
  },
  {
    id: 'logic_gates_4',
    chapterId: 'logic_gates',
    order: 4,
    title: 'NAND Gate (Combination)',
    description: 'Combine NOT and AND to create a NAND gate.',
    educationalConcept: {
      title: 'NAND Gate',
      explanation: 'NAND = NOT + AND. It outputs LOW only when ALL inputs are HIGH (opposite of AND). NAND is special: it\'s a "universal gate" - you can build ANY logic circuit using only NAND gates!',
      keyTerms: [
        { term: 'NAND Gate', definition: 'NOT-AND: output is LOW only when all inputs are HIGH' },
        { term: 'Universal Gate', definition: 'Can be used to create any other logic gate' },
        { term: 'Gate Combination', definition: 'Building complex logic from simpler gates' },
      ],
      relatedComponents: ['and_gate', 'not_gate', 'led'],
    },
    prerequisiteLevelId: 'logic_gates_3',
    objectives: [
      {
        id: 'logic_gates_4_build_nand',
        description: 'Build a NAND using AND and NOT gates',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'and_gate' },
        required: true,
        order: 1,
      },
      {
        id: 'logic_gates_4_add_not',
        description: 'Add a NOT gate after the AND',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'not_gate' },
        required: true,
        order: 2,
      },
      {
        id: 'logic_gates_4_verify',
        description: 'Verify: LED is OFF only when both inputs are HIGH',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 3,
      },
    ],
    hints: [
      {
        id: 'logic_gates_4_hint_1',
        order: 1,
        content: 'Connect: Switches → AND gate → NOT gate → LED',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'logic_gates_4_hint_2',
        order: 2,
        content: 'Test all 4 combinations: 00→ON, 01→ON, 10→ON, 11→OFF',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 90,
    bonusXp: 45,
    timeBonusThresholdSeconds: 180,
    unlocksLevelIds: ['logic_gates_5'],
  },
  {
    id: 'logic_gates_5',
    chapterId: 'logic_gates',
    order: 5,
    title: 'Logic Challenge: XOR',
    description: 'Build an XOR gate - output HIGH when inputs DIFFER.',
    educationalConcept: {
      title: 'XOR Gate (Exclusive OR)',
      explanation: 'XOR outputs HIGH when inputs are DIFFERENT (one HIGH, one LOW). It\'s "exclusive" - either one but NOT both. XOR is used in arithmetic circuits and encryption!',
      formula: 'XOR = (A AND NOT B) OR (NOT A AND B)',
      formulaDescription: 'XOR using basic gates',
      keyTerms: [
        { term: 'XOR Gate', definition: 'Output is 1 when inputs are different' },
        { term: 'Exclusive OR', definition: 'True if one or the other, but not both' },
        { term: 'Complex Logic', definition: 'Combining multiple gates to achieve a function' },
      ],
      relatedComponents: ['and_gate', 'or_gate', 'not_gate', 'led'],
    },
    prerequisiteLevelId: 'logic_gates_4',
    objectives: [
      {
        id: 'logic_gates_5_build_xor',
        description: 'Build an XOR using AND, OR, and NOT gates',
        type: 'component_count',
        config: { type: 'component_count', min: 5 },
        required: true,
        order: 1,
      },
      {
        id: 'logic_gates_5_test_xor',
        description: 'LED ON when exactly one switch is closed',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'logic_gates_5_hint_1',
        order: 1,
        content: 'XOR = (A AND !B) OR (!A AND B). You need 2 AND gates, 2 NOT gates, and 1 OR gate.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'logic_gates_5_hint_2',
        order: 2,
        content: 'Path 1: A → AND with NOT B. Path 2: NOT A → AND with B. Both paths → OR → LED.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 120,
    bonusXp: 60,
    timeBonusThresholdSeconds: 300,
    unlocksLevelIds: ['advanced_1'],
  },
];

// ==================== Chapter 6: Advanced ====================

const advancedLevels: TutorialLevel[] = [
  {
    id: 'advanced_1',
    chapterId: 'advanced',
    order: 1,
    title: 'Transistor Basics',
    description: 'Meet the transistor - the building block of modern electronics.',
    educationalConcept: {
      title: 'NPN Transistor',
      explanation: 'A transistor is like an electronic switch controlled by current. A small current at the Base controls a large current from Collector to Emitter. This is amplification! Transistors power every computer chip.',
      keyTerms: [
        { term: 'Transistor', definition: 'A semiconductor device that amplifies or switches signals' },
        { term: 'Base', definition: 'The control terminal that turns the transistor on/off' },
        { term: 'Collector/Emitter', definition: 'The main current path controlled by the base' },
        { term: 'Amplification', definition: 'Using small signal to control larger signal' },
      ],
      relatedComponents: ['transistor', 'resistor', 'led'],
    },
    objectives: [
      {
        id: 'advanced_1_add_transistor',
        description: 'Add an NPN transistor',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'transistor' },
        required: true,
        order: 1,
      },
      {
        id: 'advanced_1_switch_led',
        description: 'Use transistor to switch an LED on/off',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.5 },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'advanced_1_hint_1',
        order: 1,
        content: 'Connect: Battery(+) → LED → Collector. Emitter → Ground. Base needs a resistor from a switch.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'advanced_1_hint_2',
        order: 2,
        content: 'The base resistor limits current. Try 10kΩ. A small base current turns on the transistor.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'power_led' },
    xpReward: 100,
    bonusXp: 50,
    timeBonusThresholdSeconds: 180,
    unlocksLevelIds: ['advanced_2'],
  },
  {
    id: 'advanced_2',
    chapterId: 'advanced',
    order: 2,
    title: 'Capacitor Charging',
    description: 'Learn how capacitors store and release energy.',
    educationalConcept: {
      title: 'Capacitors',
      explanation: 'Capacitors store electrical energy like tiny rechargeable batteries. They charge up when connected to a voltage source, then can release that energy. Charging time depends on capacitance and resistance: τ = R × C.',
      formula: 'τ = R × C',
      formulaDescription: 'Time constant (seconds) = Resistance (ohms) × Capacitance (farads)',
      keyTerms: [
        { term: 'Capacitor', definition: 'Stores electrical energy in an electric field' },
        { term: 'Capacitance', definition: 'Ability to store charge, measured in Farads (F)' },
        { term: 'Time Constant', definition: 'Time to charge to 63% of final value' },
      ],
      relatedComponents: ['capacitor', 'resistor', 'battery'],
    },
    prerequisiteLevelId: 'advanced_1',
    objectives: [
      {
        id: 'advanced_2_add_capacitor',
        description: 'Add a capacitor to the circuit',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'capacitor' },
        required: true,
        order: 1,
      },
      {
        id: 'advanced_2_rc_circuit',
        description: 'Build an RC (resistor-capacitor) circuit',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'advanced_2_hint_1',
        order: 1,
        content: 'Connect: Battery(+) → Resistor → Capacitor → Battery(-). This is an RC circuit.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'advanced_2_hint_2',
        order: 2,
        content: 'Use the oscilloscope view to see the capacitor voltage rise over time!',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 100,
    bonusXp: 50,
    timeBonusThresholdSeconds: 180,
    unlocksLevelIds: ['advanced_3'],
  },
  {
    id: 'advanced_3',
    chapterId: 'advanced',
    order: 3,
    title: 'LED Blinker',
    description: 'Combine components to make an LED that blinks automatically.',
    educationalConcept: {
      title: 'Timing Circuits',
      explanation: 'By combining capacitors, resistors, and transistors, you can create circuits that oscillate between states automatically. This is the basis of clocks, timers, and blinking lights!',
      keyTerms: [
        { term: 'Oscillator', definition: 'A circuit that repeatedly switches between states' },
        { term: 'Astable', definition: 'A circuit with no stable state - always switching' },
        { term: 'Frequency', definition: 'How fast the circuit oscillates' },
      ],
      relatedComponents: ['capacitor', 'transistor', 'resistor', 'led'],
    },
    prerequisiteLevelId: 'advanced_2',
    objectives: [
      {
        id: 'advanced_3_oscillator',
        description: 'Build an oscillator circuit',
        type: 'component_count',
        config: { type: 'component_count', min: 5 },
        required: true,
        order: 1,
      },
      {
        id: 'advanced_3_blinks',
        description: 'Make the LED blink',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.3 },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'advanced_3_hint_1',
        order: 1,
        content: 'A basic blinker uses: capacitor charging → triggers transistor → capacitor discharges → repeat.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'advanced_3_hint_2',
        order: 2,
        content: 'Change the resistor or capacitor value to adjust blink speed. Larger RC = slower blink.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 120,
    bonusXp: 60,
    timeBonusThresholdSeconds: 300,
    unlocksLevelIds: ['advanced_4'],
  },
  {
    id: 'advanced_4',
    chapterId: 'advanced',
    order: 4,
    title: 'Transistor Amplifier',
    description: 'Use a transistor to amplify a weak signal.',
    educationalConcept: {
      title: 'Signal Amplification',
      explanation: 'Transistors can amplify signals - a small input signal at the base creates a larger output signal at the collector. The gain (β) determines how much amplification occurs. This is how audio amplifiers work!',
      formula: 'I_collector = β × I_base',
      formulaDescription: 'Collector current = gain × base current',
      keyTerms: [
        { term: 'Amplifier', definition: 'A circuit that increases signal strength' },
        { term: 'Gain (β)', definition: 'The amplification factor of a transistor' },
        { term: 'Signal', definition: 'Varying voltage or current carrying information' },
      ],
      relatedComponents: ['transistor', 'resistor', 'capacitor'],
    },
    prerequisiteLevelId: 'advanced_3',
    objectives: [
      {
        id: 'advanced_4_amplifier',
        description: 'Build a common-emitter amplifier',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'transistor' },
        required: true,
        order: 1,
      },
      {
        id: 'advanced_4_biasing',
        description: 'Add proper biasing resistors',
        type: 'add_component',
        config: { type: 'add_component', componentType: 'resistor', count: 2 },
        required: true,
        order: 2,
      },
      {
        id: 'advanced_4_working',
        description: 'Verify the circuit amplifies the input',
        type: 'simulation_success',
        config: { type: 'simulation_success' },
        required: true,
        order: 3,
      },
    ],
    hints: [
      {
        id: 'advanced_4_hint_1',
        order: 1,
        content: 'A common-emitter amplifier: input at base (with coupling capacitor), output at collector.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'advanced_4_hint_2',
        order: 2,
        content: 'You need bias resistors to set the operating point. Collector resistor limits current.',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 130,
    bonusXp: 65,
    timeBonusThresholdSeconds: 300,
    unlocksLevelIds: ['advanced_5'],
  },
  {
    id: 'advanced_5',
    chapterId: 'advanced',
    order: 5,
    title: 'Final Challenge: Light-Controlled Circuit',
    description: 'Build a circuit that responds to light levels.',
    educationalConcept: {
      title: 'Sensor Circuits',
      explanation: 'Real-world electronics often use sensors to detect the environment. A light-dependent resistor (LDR) changes resistance based on light. Combined with a transistor, you can create automatic night lights!',
      keyTerms: [
        { term: 'Sensor', definition: 'A component that responds to physical conditions' },
        { term: 'LDR', definition: 'Light Dependent Resistor - resistance decreases with more light' },
        { term: 'Threshold', definition: 'The point at which the circuit changes state' },
        { term: 'Automatic Control', definition: 'Circuit responds to environment without human input' },
      ],
      relatedComponents: ['potentiometer', 'transistor', 'resistor', 'led'],
    },
    prerequisiteLevelId: 'advanced_4',
    objectives: [
      {
        id: 'advanced_5_sensor_circuit',
        description: 'Build a light-sensitive circuit',
        type: 'component_count',
        config: { type: 'component_count', min: 4 },
        required: true,
        order: 1,
      },
      {
        id: 'advanced_5_automatic',
        description: 'Make LED turn on automatically in darkness',
        type: 'power_led',
        config: { type: 'power_led', minBrightness: 0.3 },
        required: true,
        order: 2,
      },
    ],
    hints: [
      {
        id: 'advanced_5_hint_1',
        order: 1,
        content: 'Create a voltage divider with LDR and resistor. Use the midpoint to control transistor base.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'advanced_5_hint_2',
        order: 2,
        content: 'When dark, LDR resistance increases, more voltage at divider midpoint turns on transistor and LED.',
        triggerCondition: { type: 'user_request' },
      },
      {
        id: 'advanced_5_hint_3',
        order: 3,
        content: 'Congratulations! You\'ve mastered circuit fundamentals. Keep experimenting and building!',
        triggerCondition: { type: 'user_request' },
      },
    ],
    target: { type: 'custom' },
    xpReward: 150,
    bonusXp: 75,
    timeBonusThresholdSeconds: 360,
  },
];

// ==================== Chapter Definitions ====================

export const TUTORIAL_CHAPTERS: TutorialChapter[] = [
  {
    id: 'basics',
    title: 'Circuit Basics',
    description: 'Learn the fundamentals of electrical circuits - what they are, how they work, and how to build them.',
    icon: 'zap',
    color: 'green',
    educationalConcepts: ['Complete circuits', 'Current flow', 'Switches', 'Ground', 'Circuit protection'],
    levels: basicsLevels,
  },
  {
    id: 'ohms_law',
    title: 'Ohm\'s Law',
    description: 'Master the most important formula in electronics: V = I × R. Learn to calculate voltage, current, and resistance.',
    icon: 'calculator',
    color: 'blue',
    prerequisiteChapterId: 'basics',
    educationalConcepts: ['Voltage', 'Current', 'Resistance', 'Power', 'Circuit analysis'],
    levels: ohmsLawLevels,
  },
  {
    id: 'led_circuits',
    title: 'LED Circuits',
    description: 'Design LED circuits with proper current limiting. Learn about forward voltage and safe operation.',
    icon: 'lightbulb',
    color: 'yellow',
    prerequisiteChapterId: 'ohms_law',
    educationalConcepts: ['Forward voltage', 'Current limiting', 'LED brightness', 'Multiple LEDs'],
    levels: ledCircuitsLevels,
  },
  {
    id: 'series_parallel',
    title: 'Series & Parallel',
    description: 'Understand how components combine in series and parallel configurations.',
    icon: 'git-branch',
    color: 'purple',
    prerequisiteChapterId: 'led_circuits',
    educationalConcepts: ['Series resistance', 'Parallel resistance', 'Current division', 'Voltage division'],
    levels: seriesParallelLevels,
  },
  {
    id: 'logic_gates',
    title: 'Logic Gates',
    description: 'Enter the digital world! Learn how AND, OR, and NOT gates process binary signals.',
    icon: 'cpu',
    color: 'cyan',
    prerequisiteChapterId: 'series_parallel',
    educationalConcepts: ['Binary logic', 'Truth tables', 'AND gate', 'OR gate', 'NOT gate', 'Combinations'],
    levels: logicGatesLevels,
  },
  {
    id: 'advanced',
    title: 'Advanced Circuits',
    description: 'Explore transistors, capacitors, and complex circuit designs.',
    icon: 'rocket',
    color: 'red',
    prerequisiteChapterId: 'logic_gates',
    educationalConcepts: ['Transistor switching', 'Capacitor charging', 'Timing circuits', 'Amplification'],
    levels: advancedLevels,
  },
];

// ==================== Helper Functions ====================

/**
 * Get a chapter by its ID
 */
export function getChapterById(chapterId: TutorialChapterId): TutorialChapter | undefined {
  return TUTORIAL_CHAPTERS.find(c => c.id === chapterId);
}

/**
 * Get a level by its ID
 */
export function getLevelById(levelId: string): TutorialLevel | undefined {
  for (const chapter of TUTORIAL_CHAPTERS) {
    const level = chapter.levels.find(l => l.id === levelId);
    if (level) return level;
  }
  return undefined;
}

/**
 * Get all levels across all chapters
 */
export function getAllLevels(): TutorialLevel[] {
  return TUTORIAL_CHAPTERS.flatMap(c => c.levels);
}

/**
 * Get the total number of levels
 */
export function getTotalLevelCount(): number {
  return TUTORIAL_CHAPTERS.reduce((sum, c) => sum + c.levels.length, 0);
}

/**
 * Get levels for a specific chapter
 */
export function getLevelsForChapter(chapterId: TutorialChapterId): TutorialLevel[] {
  const chapter = getChapterById(chapterId);
  return chapter?.levels ?? [];
}
